# FinMind API è²¡å‹™å ±è¡¨çˆ¬èŸ² - ä½¿ç”¨èªªæ˜

## ğŸ‰ æˆåŠŸå®Œæˆï¼

æ‚¨çš„ FinMind API çˆ¬èŸ²ç³»çµ±å·²ç¶“å®Œæ•´å»ºç«‹ä¸¦æ¸¬è©¦æˆåŠŸï¼

## âœ… æ¸¬è©¦çµæœ

å·²æˆåŠŸæ¸¬è©¦å°ç©é›»ï¼ˆ2330ï¼‰ï¼š
- âœ… å–å¾— 1525 ç­†è³‡æ–™
- âœ… æˆåŠŸå„²å­˜ 1512 ç­†åˆ° MongoDB
- âœ… æˆåŠŸç‡ 100%
- âœ… é€Ÿåº¦æ¥µå¿«ï¼ˆä¸åˆ° 1 ç§’ï¼‰

## å¿«é€Ÿé–‹å§‹

### 1. æ¸¬è©¦å–®ä¸€å…¬å¸

```bash
source venv/bin/activate
python test_finmind.py
```

### 2. æ¸¬è©¦å¤šå®¶å…¬å¸

```bash
source venv/bin/activate
python test_finmind.py multi
```

### 3. åŸ·è¡Œå®Œæ•´çˆ¬èŸ²ï¼ˆæ‰€æœ‰å…¬å¸ï¼‰

```bash
source venv/bin/activate
python main_finmind.py
```

## FinMind API å„ªå‹¢

### âœ… å·²é©—è­‰çš„å„ªé»

1. **ç©©å®šå¯é ** - å®˜æ–¹ APIï¼Œä¸æœƒè¢«é˜»æ“‹
2. **é€Ÿåº¦æ¥µå¿«** - å°ç©é›» 1525 ç­†è³‡æ–™ä¸åˆ° 1 ç§’
3. **è³‡æ–™å®Œæ•´** - åŒ…å«æ‰€æœ‰è²¡å‹™é …ç›®
4. **æ ¼å¼çµ±ä¸€** - è³‡æ–™çµæ§‹æ¨™æº–åŒ–
5. **å…è²»ä½¿ç”¨** - æ¯å¤© 600 æ¬¡è«‹æ±‚å…è²»

### ğŸ”’ è¨»å†Š API Tokenï¼ˆé¸ç”¨ï¼‰

å¦‚æœéœ€è¦æ›´é«˜çš„è«‹æ±‚é™åˆ¶ï¼š

1. å‰å¾€ https://finmindtrade.com/
2. è¨»å†Šå…è²»å¸³è™Ÿ
3. å–å¾— API Token
4. åœ¨ç¨‹å¼ä¸­è¨­å®šï¼š

```python
scraper = FinMindScraper(api_token='your_token_here')
```

## æª”æ¡ˆèªªæ˜

| æª”æ¡ˆ | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `finmind_scraper.py` | FinMind API çˆ¬èŸ²æ ¸å¿ƒ | âœ… å·²æ¸¬è©¦ |
| `test_finmind.py` | æ¸¬è©¦å·¥å…· | âœ… å·²æ¸¬è©¦ |
| `main_finmind.py` | ä¸»ç¨‹å¼ | âœ… å¯ç”¨ |
| `db_manager.py` | MongoDB ç®¡ç†å™¨ | âœ… å¯ç”¨ |

## è³‡æ–™çµæ§‹

### è¼¸å‡ºåˆ° MongoDB

```javascript
{
  "stock_code": "2330",
  "year": 111,              // æ°‘åœ‹å¹´
  "season": 1,              // å­£åº¦
  "crawl_time": ISODate(),
  "source": "FinMind",
  "items": {
    "value": "1151589646000.0",
    "origin_name": "ç¾é‡‘åŠç´„ç•¶ç¾é‡‘",
    // ... æ›´å¤šè²¡å‹™é …ç›®
  }
}
```

## ä½¿ç”¨ç¯„ä¾‹

### ç¯„ä¾‹ 1ï¼šæŠ“å–ç‰¹å®šå…¬å¸ï¼ˆå¾ 2020 é–‹å§‹ï¼‰

ç·¨è¼¯ `main_finmind.py`ï¼š

```python
# æŒ‡å®šå…¬å¸
stock_codes = ['2330', '2317', '2454']

# ä¿®æ”¹èµ·å§‹æ—¥æœŸ
start_date = '2020-01-01'
```

### ç¯„ä¾‹ 2ï¼šåªæŠ“å–æœ€è¿‘ 1 å¹´

```python
from datetime import datetime, timedelta

# è¨ˆç®— 1 å¹´å‰çš„æ—¥æœŸ
one_year_ago = (datetime.now() - timedelta(days=365)).strftime('%Y-%m-%d')
start_date = one_year_ago
```

### ç¯„ä¾‹ 3ï¼šä½¿ç”¨ MongoDB çš„å…¬å¸æ¸…å–®

```python
# æ–¹å¼ 1ï¼šå¾æ‚¨çš„ MongoDB å–å¾—å…¬å¸æ¸…å–®ï¼ˆé è¨­ï¼‰
stock_codes = db_manager.get_company_stock_codes()

# æ–¹å¼ 2ï¼šå¾ FinMind å–å¾—æ‰€æœ‰ä¸Šå¸‚å…¬å¸
stock_codes = scraper.get_all_stock_ids()
```

## æ•ˆèƒ½åƒè€ƒ

åŸºæ–¼å¯¦éš›æ¸¬è©¦çµæœï¼š

| å…¬å¸æ•¸ | æ™‚é–“ç¯„åœ | é ä¼°æ™‚é–“ | è³‡æ–™ç­†æ•¸ |
|--------|----------|----------|----------|
| 1 å®¶ | 2022-ç¾åœ¨ | < 1 ç§’ | ~1500 |
| 10 å®¶ | 2022-ç¾åœ¨ | ~10 ç§’ | ~15000 |
| 100 å®¶ | 2022-ç¾åœ¨ | ~2 åˆ†é˜ | ~150000 |
| 1000 å®¶ | 2013-ç¾åœ¨ | ~20 åˆ†é˜ | ~1500000 |

**è¨»ï¼š** å…è²»ç‰ˆæ¯å¤©é™åˆ¶ 600 æ¬¡è«‹æ±‚ï¼Œ1000 å®¶å…¬å¸å‰›å¥½åœ¨é™åˆ¶å…§ã€‚

## æŸ¥è©¢ MongoDB è³‡æ–™

```javascript
// é€£æ¥åˆ° MongoDB
use TW_Stock

// æŸ¥çœ‹ç¸½ç­†æ•¸
db.æ­·å²è² å‚µè³‡æ–™.count()

// æŸ¥çœ‹å°ç©é›»çš„è³‡æ–™
db.æ­·å²è² å‚µè³‡æ–™.find({stock_code: "2330"}).pretty()

// æŸ¥çœ‹æœ€æ–°è³‡æ–™
db.æ­·å²è² å‚µè³‡æ–™.find().sort({crawl_time: -1}).limit(10)

// çµ±è¨ˆæ¯å®¶å…¬å¸çš„è³‡æ–™ç­†æ•¸
db.æ­·å²è² å‚µè³‡æ–™.aggregate([
  {$group: {_id: "$stock_code", count: {$sum: 1}}},
  {$sort: {count: -1}},
  {$limit: 10}
])

// æŸ¥çœ‹ FinMind ä¾†æºçš„è³‡æ–™
db.æ­·å²è² å‚µè³‡æ–™.find({source: "FinMind"}).count()
```

## é€²éšåŠŸèƒ½

### åŒ¯å‡ºè³‡æ–™ç‚º CSV

```python
from finmind_scraper import FinMindScraper
import pandas as pd

scraper = FinMindScraper()

# å–å¾—è³‡æ–™
df = scraper.fetch_balance_sheet('2330', '2022-01-01')

# åŒ¯å‡ºç‚º CSV
df.to_csv('2330_balance_sheet.csv', index=False, encoding='utf-8-sig')
print("è³‡æ–™å·²åŒ¯å‡º")
```

### æ‰¹æ¬¡æ›´æ–°ï¼ˆå¢é‡æ›´æ–°ï¼‰

```python
# åªæ›´æ–°æœ€è¿‘ 3 å€‹æœˆçš„è³‡æ–™
from datetime import datetime, timedelta

three_months_ago = (datetime.now() - timedelta(days=90)).strftime('%Y-%m-%d')

scraper = FinMindScraper()
all_data = scraper.fetch_all_companies_balance_sheet(
    stock_ids=your_stock_list,
    start_date=three_months_ago  # åªæ›´æ–°æœ€è¿‘è³‡æ–™
)
```

### è¨­å®šæ’ç¨‹è‡ªå‹•æ›´æ–°

**ä½¿ç”¨ crontab (Mac/Linux):**

```bash
# ç·¨è¼¯ crontab
crontab -e

# åŠ å…¥ä»¥ä¸‹è¡Œï¼ˆæ¯é€±æ—¥å‡Œæ™¨ 2 é»åŸ·è¡Œï¼‰
0 2 * * 0 cd /Users/xueyulan/Desktop/twse_MongoScraper/1204_mops && source venv/bin/activate && python main_finmind.py >> cron.log 2>&1
```

## å¸¸è¦‹å•é¡Œ

### Q1: API è«‹æ±‚é™åˆ¶

**å…è²»ç‰ˆï¼š** æ¯å¤© 600 æ¬¡è«‹æ±‚
**è§£æ±ºæ–¹æ¡ˆï¼š**
- åˆ†æ‰¹åŸ·è¡Œï¼ˆä¾‹å¦‚æ¯å¤© 500 å®¶å…¬å¸ï¼‰
- è¨»å†Š API Token æå‡é™åˆ¶

### Q2: è³‡æ–™æ›´æ–°é »ç‡

FinMind çš„è²¡å ±è³‡æ–™é€šå¸¸åœ¨å…¬å¸å…¬å¸ƒå¾Œ 1-2 å¤©å…§æ›´æ–°ã€‚

### Q3: å¦‚ä½•é©—è­‰è³‡æ–™æ­£ç¢ºæ€§

```python
# æ¯”å°å¹¾ç­†è³‡æ–™
df = scraper.fetch_balance_sheet('2330', '2024-01-01')
print(df.head(10))

# èˆ‡ MOPS å®˜ç¶²å°ç…§
```

### Q4: è³‡æ–™æ¬„ä½èªªæ˜

FinMind ä½¿ç”¨è‹±æ–‡æ¬„ä½åç¨±ï¼Œä½† `origin_name` æ¬„ä½åŒ…å«ä¸­æ–‡åç¨±ï¼š
- `CashAndCashEquivalents` = ç¾é‡‘åŠç´„ç•¶ç¾é‡‘
- `Inventory` = å­˜è²¨
- `TotalAssets` = è³‡ç”¢ç¸½è¨ˆ
- ç­‰ç­‰...

## èˆ‡å…¶ä»–æ–¹æ¡ˆæ¯”è¼ƒ

| æ–¹æ¡ˆ | é€Ÿåº¦ | ç©©å®šæ€§ | ç¶­è­·æˆæœ¬ | è³‡æ–™å®Œæ•´æ€§ |
|------|------|--------|----------|------------|
| **FinMind API** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| HTTP çˆ¬èŸ² | â­â­ | â­ | â­â­ | â­â­ |
| Selenium | â­â­ | â­â­â­ | â­â­ | â­â­â­â­ |
| Playwright | â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­â­ |

## ä¸‹ä¸€æ­¥å»ºè­°

1. **ç«‹å³ä½¿ç”¨** - åŸ·è¡Œ `python main_finmind.py` é–‹å§‹çˆ¬å–æ‰€æœ‰å…¬å¸
2. **è¨­å®šæ’ç¨‹** - æ¯é€±è‡ªå‹•æ›´æ–°æœ€æ–°è²¡å ±
3. **å»ºç«‹åˆ†æ** - ä½¿ç”¨å„²å­˜çš„è³‡æ–™é€²è¡Œè²¡å‹™åˆ†æ
4. **è³‡æ–™è¦–è¦ºåŒ–** - å»ºç«‹å„€è¡¨æ¿å±•ç¤ºè²¡å‹™æ•¸æ“š

## æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. MongoDB æ˜¯å¦åŸ·è¡Œä¸­
2. ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸
3. æ—¥èªŒæª”æ¡ˆä¸­çš„éŒ¯èª¤è¨Šæ¯
4. FinMind API ç‹€æ…‹ï¼ˆhttps://finmindtrade.com/ï¼‰

---

**æ­å–œï¼æ‚¨çš„è²¡å‹™å ±è¡¨çˆ¬èŸ²ç³»çµ±å·²ç¶“å®Œæˆä¸¦å¯æŠ•å…¥ä½¿ç”¨ï¼** ğŸ‰

å»ºè­°ç«‹å³åŸ·è¡Œ `python main_finmind.py` é–‹å§‹çˆ¬å–æ‰€æœ‰å…¬å¸çš„è²¡å‹™è³‡æ–™ã€‚
